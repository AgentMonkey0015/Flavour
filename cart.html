<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cart â€“ Flavour</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script type="module" src="https://cdn.jsdelivr.net/npm/ldrs/dist/auto/waveform.js"></script>
  <style>
    :root {
      --jungle-green: #44af69;
      --strawberry-red: #f8333c;
      --orange: #fcab10;
      --pacific-blue: #2b9eb3;
      --sand-dune: #dbd5b5;
    }
    body {
      background-color: var(--sand-dune);
    }
    .cart-card {
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      transition: transform 0.2s ease;
    }
    .cart-card:hover {
      transform: translateY(-2px);
    }
    button {
      transition: all 0.2s ease;
    }
    button:active {
      transform: scale(0.97);
    }
  </style>
</head>
<body class="min-h-screen p-4 md:p-8">

 
  <nav class="bg-[var(--jungle-green)] text-white px-6 py-4 rounded-2xl mb-8 flex items-center justify-between">
    <div class="flex items-center gap-3">
      <h1 class="text-2xl font-bold">Flavour.</h1>
    </div>
    <a href="Menu.Html" class="bg-white text-[var(--jungle-green)] px-4 py-2 rounded-lg font-semibold hover:opacity-90">
      Back to Menu
    </a>
  </nav>

  <div class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-6">
    
   
    <div class="lg:col-span-2">
      <div class="bg-white rounded-2xl p-6 cart-card">
        <h2 class="text-2xl font-bold mb-6" style="color: var(--jungle-green);">Your Cart</h2>
        <div id="cartItems" class="space-y-4">
      
        </div>
        <div id="emptyCart" class="text-center py-12 hidden">
          <p class="text-gray-500 text-lg mb-4">Your cart is empty</p>
          <a href="menu.html" class="inline-block bg-[var(--jungle-green)] text-white px-6 py-3 rounded-lg font-semibold">
            Browse Menu
          </a>
        </div>
      </div>
    </div>

    <div class="space-y-6">
      
      
      <div class="bg-white rounded-2xl p-6 cart-card">
        <h3 class="text-xl font-bold mb-4" style="color: var(--orange);">Apply Coupon</h3>
        <form id="couponForm" class="space-y-3">
          <input 
            type="text" 
            id="couponInput" 
            placeholder="Enter coupon code" 
            class="w-full px-4 py-3 border-2 rounded-lg focus:outline-none"
            style="border-color: var(--jungle-green);"
          >
          <button 
            type="submit" 
            class="w-full bg-[var(--pacific-blue)] text-white py-3 rounded-lg font-semibold"
          >
            Apply Coupon
          </button>
        </form>
        <p id="couponError" class="text-sm font-semibold mt-2 hidden" style="color: var(--strawberry-red);"></p>
        <div id="appliedCoupons" class="mt-4 space-y-2">
          
        </div>
      </div>

      
      <div class="bg-white rounded-2xl p-6 cart-card">
        <h3 class="text-xl font-bold mb-4" style="color: var(--jungle-green);">Order Summary</h3>
        <div class="space-y-3 text-gray-700">
          <div class="flex justify-between">
            <span>Subtotal:</span>
            <span id="subtotal" class="font-semibold">â‚¦0.00</span>
          </div>
          <div class="flex justify-between">
            <span>VAT (5%):</span>
            <span id="vat" class="font-semibold">â‚¦0.00</span>
          </div>
          <div class="flex justify-between text-red-600">
            <span>Item Discounts:</span>
            <span id="itemDiscounts" class="font-semibold">-â‚¦0.00</span>
          </div>
          <div class="flex justify-between text-red-600">
            <span>Coupon Discounts:</span>
            <span id="couponDiscounts" class="font-semibold">-â‚¦0.00</span>
          </div>
          <div class="flex justify-between">
            <span>Delivery Fee:</span>
            <span id="deliveryFee" class="font-semibold">â‚¦500.00</span>
          </div>
          <hr class="my-3">
          <div class="flex justify-between text-xl font-bold" style="color: var(--orange);">
            <span>Total:</span>
            <span id="total">â‚¦0.00</span>
          </div>
        </div>
        <button 
          id="checkoutBtn"
          class="w-full mt-6 bg-[var(--strawberry-red)] text-white py-4 rounded-xl font-bold text-lg hover:opacity-90"
        >
          Proceed to Checkout
        </button>
      </div>
    </div>
  </div>

  <div id="loaderOverlay" class="fixed inset-0 bg-black/40 hidden items-center justify-center z-50">
    <l-waveform size="45" stroke="4" speed="1" color="#ffffff"></l-waveform>
  </div>
  <div id="successOverlay" class="fixed inset-0 bg-black/40 hidden items-center justify-center z-50">
    <div class="bg-white rounded-2xl p-8 max-w-sm w-full text-center shadow-xl">
      <h2 class="text-2xl font-bold mb-2" style="color: var(--jungle-green);">Order Successful ðŸŽ‰</h2>
      <p class="text-gray-600 mb-4">Your order has been placed successfully.</p>
      <p class="text-lg font-bold mb-6" style="color: var(--orange);" id="successTotal"></p>
      <button id="successClose"
        class="w-full bg-[var(--jungle-green)] text-white py-3 rounded-xl font-semibold hover:opacity-90">
        Continue Shopping
      </button>
    </div>
  </div>
  <script>
    
    const productsDB = [
      {
        "itemId": "001",
        "name": "Cheese Burger",
        "category": "Burger",
        "price": 3500,
        "availableQty": 100,
        "vat": 5,
        "discount": 0,
        "couponCode": "BURGER5",
        "couponDiscount": 5,
        "notes": "Extra Spicy"
      },
      {
        "itemId": "002",
        "name": "Shawarma",
        "category": "Side",
        "price": 3000,
        "availableQty": 200,
        "vat": 5,
        "discount": 0,
        "couponCode": "FRIES10",
        "couponDiscount": 10,
        "notes": "Fresh veggies & spicy sauce"
      },
      {
        "itemId": "003",
        "name": "Soda",
        "category": "Drink",
        "price": 350,
        "availableQty": 300,
        "vat": 5,
        "discount": 0,
        "couponCode": "SODA5",
        "couponDiscount": 5
      },
      {
        "itemId": "004",
        "name": "Chicken Burger",
        "category": "Burger",
        "price": 2550,
        "availableQty": 80,
        "vat": 5,
        "discount": 0,
        "couponCode": "CHICKEN5",
        "couponDiscount": 5,
        "notes": "No mayo"
      },
      {
        "itemId": "005",
        "name": "Chocolate Cake",
        "category": "Dessert",
        "price": 1200,
        "availableQty": 50,
        "vat": 5,
        "discount": 0,
        "couponCode": "CAKE10",
        "couponDiscount": 10
      },
     
      {
        "itemId": "006",
        "name": "Pepperoni Pizza",
        "category": "Pizza",
        "price": 2500,
        "availableQty": 50,
        "vat": 5,
        "discount": 0,
        "couponCode": "PIZZA10",
        "couponDiscount": 10,
        "notes": "Smoked pepperoni, stretchy cheese"
      },
      {
        "itemId": "007",
        "name": "Caesar Salad",
        "category": "Salad",
        "price": 2800,
        "availableQty": 40,
        "vat": 5,
        "discount": 0,
        "couponCode": "SALAD15",
        "couponDiscount": 15,
        "notes": "Crisp lettuce, parmesan, croutons"
      },
      {
        "itemId": "008",
        "name": "Fresh Orange Juice",
        "category": "Drinks",
        "price": 1500,
        "availableQty": 150,
        "vat": 5,
        "discount": 0,
        "couponCode": "JUICE5",
        "couponDiscount": 5,
        "notes": "100% Natural , No added sugar"
      },
      {
        "itemId": "009",
        "name": "Spring Rolls",
        "category": "Snacks",
        "price": 1800,
        "availableQty": 100,
        "vat": 5,
        "discount": 0,
        "couponCode": "SNACK10",
        "couponDiscount": 10,
        "notes": "Crispy golden rolls with dipping sauce"
      },
      {
        "itemId": "010",
        "name": "Grilled Chicken",
        "category": "Healthy",
        "price": 4200,
        "availableQty": 60,
        "vat": 5,
        "discount": 5,
        "couponCode": "CHICKEN10",
        "couponDiscount": 10,
        "notes": "Grilled chicken breast with herbs"
      },
      {
        "itemId": "011",
        "name": "Smoothie Bowl",
        "category": "Healthy",
        "price": 3200,
        "availableQty": 45,
        "vat": 5,
        "discount": 0,
        "couponCode": "BOWL15",
        "couponDiscount": 15,
        "notes": "Mixed berries, granola, honey drizzle"
      },
      {
        "itemId": "012",
        "name": "Iced Coffee",
        "category": "Drinks",
        "price": 1800,
        "availableQty": 200,
        "vat": 5,
        "discount": 0,
        "couponCode": "COFFEE5",
        "couponDiscount": 5,
        "notes": "Cold brew with milk and ice"
      },
      {
        "itemId": "013",
        "name": "Pizza Combo",
        "category": "Deals",
        "price": 4000,
        "availableQty": 30,
        "vat": 5,
        "discount": 10,
        "couponCode": "COMBO20",
        "couponDiscount": 20,
        "notes": "Large pizza + 2 drinks"
      }
    ];

  
    const generalCoupons = {
      "SAVE10": 10,
      "WELCOME20": 20,
      "FIRSTORDER": 15
    };

    let cartItems = JSON.parse(localStorage.getItem('cart')) || [];
    let appliedGeneralCoupon = null;
    let appliedItemCoupons = {};

    // Loader and error helpers
    let loader;
    const couponError = document.getElementById('couponError');

    // Success overlay helpers
    const successOverlay = document.getElementById('successOverlay');
    const successTotal = document.getElementById('successTotal');
    const successClose = document.getElementById('successClose');

    document.addEventListener('DOMContentLoaded', () => {
      loader = document.getElementById('loaderOverlay');
    });

    function showLoader() {
      if (!loader) return;
      loader.classList.remove('hidden');
      loader.classList.add('flex');
    }

    function hideLoader() {
      if (!loader) return;
      loader.classList.add('hidden');
      loader.classList.remove('flex');
    }

    function showCouponError(message) {
      couponError.textContent = message;
      couponError.classList.remove('hidden');
    }

    function showSuccess(totalText) {
      successTotal.textContent = `Total Paid: ${totalText}`;
      successOverlay.classList.remove('hidden');
      successOverlay.classList.add('flex');
    }

    function hideSuccess() {
      successOverlay.classList.add('hidden');
      successOverlay.classList.remove('flex');
    }

    function findProduct(name) {
      return productsDB.find(p => p.name.toLowerCase() === name.toLowerCase());
    }

    function formatPrice(price) {
      return `â‚¦${price.toLocaleString('en-NG', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
    }

    function renderCart() {
      const container = document.getElementById('cartItems');
      const emptyCart = document.getElementById('emptyCart');
      
      if (cartItems.length === 0) {
        container.classList.add('hidden');
        emptyCart.classList.remove('hidden');
        updateTotals();
        return;
      }

      container.classList.remove('hidden');
      emptyCart.classList.add('hidden');
      container.innerHTML = '';

      cartItems.forEach((item, index) => {
        const product = findProduct(item.name);
        if (!product) return;

        const basePrice = product.price * item.qty;
        const vatAmount = (basePrice * product.vat) / 100;
        const itemDiscount = (basePrice * product.discount) / 100;
        
        
        const hasCoupon = appliedItemCoupons[product.itemId];
        const couponDiscount = hasCoupon ? (basePrice * product.couponDiscount) / 100 : 0;
        
        const finalPrice = basePrice + vatAmount - itemDiscount - couponDiscount;

        const itemDiv = document.createElement('div');
        itemDiv.className = 'border-2 rounded-xl p-4';
        itemDiv.style.borderColor = 'var(--sand-dune)';
        itemDiv.innerHTML = `
          <div class="flex justify-between items-start mb-3">
            <div class="flex-1">
              <h4 class="font-bold text-lg">${product.name}</h4>
              <p class="text-sm text-gray-600">${product.category}</p>
              ${product.notes ? `<p class="text-xs text-gray-500 italic">${product.notes}</p>` : ''}
            </div>
            <button onclick="removeItem(${index})" class="text-red-500 hover:text-red-700 text-xl font-bold">Ã—</button>
          </div>
          
          <div class="space-y-2 text-sm">
            <div class="flex justify-between text-gray-600">
              <span>Base Price (Ã—${item.qty}):</span>
              <span>${formatPrice(basePrice)}</span>
            </div>
            <div class="flex justify-between text-gray-600">
              <span>VAT (${product.vat}%):</span>
              <span>${formatPrice(vatAmount)}</span>
            </div>
            ${itemDiscount > 0 ? `
              <div class="flex justify-between text-red-600">
                <span>Discount (${product.discount}%):</span>
                <span>-${formatPrice(itemDiscount)}</span>
              </div>
            ` : ''}
            ${hasCoupon ? `
              <div class="flex justify-between text-green-600 font-semibold">
                <span>Coupon (${product.couponCode}):</span>
                <span>-${formatPrice(couponDiscount)}</span>
              </div>
            ` : ''}
            <hr class="my-2">
            <div class="flex justify-between items-center font-bold text-lg" style="color: var(--orange);">
              <span>Item Total:</span>
              <span>${formatPrice(finalPrice)}</span>
            </div>
          </div>

          <div class="flex items-center justify-between mt-4">
            <div class="flex items-center gap-3 bg-gray-100 rounded-lg px-3 py-2">
              <button onclick="decreaseQty(${index})" class="text-xl font-bold" style="color: var(--strawberry-red);">âˆ’</button>
              <span class="font-semibold min-w-[2rem] text-center">${item.qty}</span>
              <button onclick="increaseQty(${index})" class="text-xl font-bold" style="color: var(--jungle-green);">+</button>
            </div>
            ${!hasCoupon && product.couponCode ? `
              <button onclick="applyItemCoupon('${product.itemId}', '${product.couponCode}')" 
                      class="text-sm px-3 py-1 rounded-lg border-2 font-semibold hover:opacity-80"
                      style="border-color: var(--pacific-blue); color: var(--pacific-blue);">
                Apply ${product.couponCode}
              </button>
            ` : ''}
          </div>
        `;
        container.appendChild(itemDiv);
      });

      updateTotals();
      saveCart();
    }

    function updateTotals() {
      let subtotal = 0;
      let totalVAT = 0;
      let totalItemDiscounts = 0;
      let totalCouponDiscounts = 0;

      cartItems.forEach(item => {
        const product = findProduct(item.name);
        if (!product) return;

        const basePrice = product.price * item.qty;
        const vatAmount = (basePrice * product.vat) / 100;
        const itemDiscount = (basePrice * product.discount) / 100;
        
        const hasCoupon = appliedItemCoupons[product.itemId];
        const couponDiscount = hasCoupon ? (basePrice * product.couponDiscount) / 100 : 0;

        subtotal += basePrice;
        totalVAT += vatAmount;
        totalItemDiscounts += itemDiscount;
        totalCouponDiscounts += couponDiscount;
      });

      const deliveryFee = cartItems.length > 0 ? 500 : 0;
      
  
      const generalCouponDiscount = appliedGeneralCoupon 
        ? (subtotal * generalCoupons[appliedGeneralCoupon]) / 100 
        : 0;
      
      totalCouponDiscounts += generalCouponDiscount;

      const total = subtotal + totalVAT - totalItemDiscounts - totalCouponDiscounts + deliveryFee;

      document.getElementById('subtotal').textContent = formatPrice(subtotal);
      document.getElementById('vat').textContent = formatPrice(totalVAT);
      document.getElementById('itemDiscounts').textContent = formatPrice(totalItemDiscounts);
      document.getElementById('couponDiscounts').textContent = formatPrice(totalCouponDiscounts);
      document.getElementById('deliveryFee').textContent = formatPrice(deliveryFee);
      document.getElementById('total').textContent = formatPrice(total);
    }

    function increaseQty(index) {
      cartItems[index].qty++;
      renderCart();
    }

    function decreaseQty(index) {
      if (cartItems[index].qty > 1) {
        cartItems[index].qty--;
        renderCart();
      }
    }

    function removeItem(index) {
      const item = cartItems[index];
      const product = findProduct(item.name);
      if (product && appliedItemCoupons[product.itemId]) {
        delete appliedItemCoupons[product.itemId];
      }
      cartItems.splice(index, 1);
      renderCart();
      renderAppliedCoupons();
    }

    function applyItemCoupon(itemId, couponCode) {
      appliedItemCoupons[itemId] = couponCode;
      renderCart();
      renderAppliedCoupons();
    }

    function renderAppliedCoupons() {
      const container = document.getElementById('appliedCoupons');
      container.innerHTML = '';

      // Show general coupon
      if (appliedGeneralCoupon) {
        const div = document.createElement('div');
        div.className = 'flex items-center justify-between bg-green-50 border-2 border-green-300 rounded-lg px-3 py-2';
        div.innerHTML = `
          <div>
            <span class="font-semibold text-green-700">${appliedGeneralCoupon}</span>
            <span class="text-xs text-green-600 ml-2">(${generalCoupons[appliedGeneralCoupon]}% off)</span>
          </div>
          <button onclick="removeGeneralCoupon()" class="text-red-500 font-bold">Ã—</button>
        `;
        container.appendChild(div);
      }

      Object.entries(appliedItemCoupons).forEach(([itemId, couponCode]) => {
        const product = productsDB.find(p => p.itemId === itemId);
        if (product) {
          const div = document.createElement('div');
          div.className = 'flex items-center justify-between bg-blue-50 border-2 border-blue-300 rounded-lg px-3 py-2';
          div.innerHTML = `
            <div class="text-sm">
              <span class="font-semibold text-blue-700">${couponCode}</span>
              <span class="text-xs text-blue-600 block">${product.name}</span>
            </div>
            <button onclick="removeItemCoupon('${itemId}')" class="text-red-500 font-bold">Ã—</button>
          `;
          container.appendChild(div);
        }
      });
    }

    function removeGeneralCoupon() {
      appliedGeneralCoupon = null;
      renderCart();
      renderAppliedCoupons();
    }

    function removeItemCoupon(itemId) {
      delete appliedItemCoupons[itemId];
      renderCart();
      renderAppliedCoupons();
    }

    document.getElementById('couponForm').addEventListener('submit', (e) => {
      e.preventDefault();
      couponError.classList.add('hidden');

      if (cartItems.length === 0) {
        showCouponError('Your cart is empty. Add items before applying a coupon.');
        return;
      }

      const code = document.getElementById('couponInput').value.trim().toUpperCase();

      if (!code) {
        showCouponError('Please enter a coupon code.');
        return;
      }

      if (generalCoupons[code]) {
        appliedGeneralCoupon = code;
        document.getElementById('couponInput').value = '';
        renderCart();
        renderAppliedCoupons();
        return;
      }

      if (code === 'EXPIRED10' || code === 'OLDPROMO') {
        showCouponError('This coupon has expired.');
        return;
      }

      const product = productsDB.find(p => p.couponCode === code);
      if (product) {
        const cartItem = cartItems.find(item => item.name === product.name);
        if (!cartItem) {
          showCouponError(`Add ${product.name} to cart to use this coupon.`);
          return;
        }
        appliedItemCoupons[product.itemId] = code;
        document.getElementById('couponInput').value = '';
        renderCart();
        renderAppliedCoupons();
        return;
      }

      showCouponError('Invalid coupon code.');
    });

    document.getElementById('checkoutBtn').addEventListener('click', async () => {
      if (cartItems.length === 0) {
        showCouponError('Your cart is empty.');
        return;
      }

      showLoader();

      await new Promise(res => setTimeout(res, 2000)); // simulate transaction

      hideLoader();

      const totalText = document.getElementById('total').textContent;
      showSuccess(totalText);

      cartItems = [];
      appliedGeneralCoupon = null;
      appliedItemCoupons = {};
      saveCart();
      renderCart();
      renderAppliedCoupons();
    });

    function saveCart() {
      localStorage.setItem('cart', JSON.stringify(cartItems));
    }

   
    renderCart();
    renderAppliedCoupons();

    
    successClose.addEventListener('click', () => {
      hideSuccess();
      window.location.href = 'menu.html';
    });
  </script>
</body>
</html>